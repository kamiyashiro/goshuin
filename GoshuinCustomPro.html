<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Goshuin Custom Pro - Full Version</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Klee+One&family=Kosugi+Maru&family=Potta+One&family=Yuji+Boku&family=Yuji+Syuku&family=Zen+Kurenaido&family=Zen+Old+Mincho&display=swap" rel="stylesheet">
<style>
body { margin:0; padding:20px; background:#f0f0f0; font-family:sans-serif; text-align:center;}
#wrap { max-width:900px; margin:0 auto; background:white; padding:30px; box-shadow:0 0 20px rgba(0,0,0,0.2); border-radius:15px;}
h1{color:#d40000; font-size:32px; margin-bottom:20px;}
.tabs{display:flex; flex-wrap:wrap; gap:10px; justify-content:center; margin-bottom:20px;}
.tab-btn{padding:12px 24px; background:#ddd; cursor:pointer; border-radius:10px 10px 0 0; font-weight:bold;}
.tab-btn.active{background:#fff; border:2px solid #d40000; border-bottom:none;}
.tab-content{display:none; background:#fff; padding:30px; border:2px solid #d40000; border-radius:0 10px 10px 10px;}
.tab-content.active{display:block;}
.controls-row{display:flex; flex-wrap:wrap; gap:15px; margin-bottom:20px; align-items:center; justify-content:center;}
.controls-row label{font-weight:bold; min-width:100px;}
input[type="range"]{width:180px;}
span{min-width:60px; display:inline-block; text-align:left; font-weight:bold;}
canvas{border:4px solid #333; box-shadow:0 10px 30px rgba(0,0,0,0.4); background:white; margin-top:30px; cursor:grab;}
#template-list{display:flex; gap:15px; flex-wrap:wrap; justify-content:center; margin-top:20px;}
.template-thumb{width:120px; height:120px; border:3px solid #ccc; cursor:pointer; position:relative; border-radius:10px; overflow:hidden;}
.template-thumb img{width:100%; height:100%; object-fit:cover;}
.template-thumb.selected{border-color:#d40000; box-shadow:0 0 15px #d40000;}
.delete-btn{position:absolute; top:0; right:0; background:rgba(255,0,0,0.8); color:white; border:none; width:30px; height:30px; cursor:pointer; font-size:18px;}
button.big-btn{padding:20px 40px; font-size:20px; background:#d40000; color:white; border:none; border-radius:10px; cursor:pointer; margin:10px;}
button.big-btn:hover{background:#b00000;}
#version{margin-top:50px; font-size:16px; color:#666;}
</style>
</head>
<body>
<div id="wrap">
<h1>Goshuin Custom Pro - Full Version</h1>
<div class="tabs">
<div class="tab-btn active" data-tab="background">背景</div>
<div class="tab-btn" data-tab="date">日付</div>
<div class="tab-btn" data-tab="hohei">奉拝</div>
<div class="tab-btn" data-tab="jinja">神社名</div>
<div class="tab-btn" data-tab="stamp">朱印</div>
<div class="tab-btn" data-tab="save">保存/設定</div>
</div>

<div id="background" class="tab-content active">
<p>テンプレート画像をアップロード（複数可・ドラッグ＆ドロップ）</p>
<input type="file" id="templateUpload" accept="image/*" multiple style="padding:10px;font-size:16px;">
<div id="template-list"></div>
</div>

<div id="date" class="tab-content">
<div class="controls-row">
<label>表示:</label> <input type="checkbox" id="dateEnabled" checked>
<label>フォント:</label>
<select id="dateFont">
<option value="Klee One" selected>Klee One</option>
<option value="Kosugi Maru">Kosugi Maru</option>
<option value="Potta One">Potta One</option>
<option value="Yuji Boku">Yuji Boku</option>
<option value="Yuji Syuku">Yuji Syuku</option>
<option value="Zen Old Mincho">Zen Old Mincho</option>
<option value="'MS Gothic',sans-serif">MS Gothic</option>
<option value="'MS Mincho',serif">MS Mincho</option>
</select>
<input type="text" id="dateFontCustom" placeholder="自由入力" size="15">
<button onclick="setCustomFont('date')">適用</button>
</div>

<div class="controls-row">
<label>年:</label> <select id="yearSelect"></select>
<button id="prevMonthBtn">◀ 前月</button>
<button id="nextMonthBtn">次月 ▶</button>
</div>

<div class="controls-row">
<label>X位置:</label> <input type="range" id="dateX" min="0" max="512" value="256"><span id="dateXVal">256</span>
<label>Y位置:</label> <input type="range" id="dateY" min="0" max="512" value="200"><span id="dateYVal">200</span>
</div>

<div class="controls-row">
<label>サイズ:</label> <input type="range" id="dateSize" min="20" max="80" value="40"><span id="dateSizeVal">40</span>
</div>
</div>

<div id="hohei" class="tab-content">
<div class="controls-row">
<label>表示:</label> <input type="checkbox" id="hoheiEnabled" checked>
<label>フォント:</label>
<select id="hoheiFont">
<option value="Klee One" selected>Klee One</option>
<option value="Kosugi Maru">Kosugi Maru</option>
<option value="Potta One">Potta One</option>
<option value="Yuji Boku">Yuji Boku</option>
<option value="Yuji Syuku">Yuji Syuku</option>
<option value="Zen Old Mincho">Zen Old Mincho</option>
<option value="'MS Gothic',sans-serif">MS Gothic</option>
<option value="'MS Mincho',serif">MS Mincho</option>
</select>
</div>

<div class="controls-row">
<label>X位置:</label> <input type="range" id="hoheiX" min="0" max="512" value="256"><span id="hoheiXVal">256</span>
<label>Y位置:</label> <input type="range" id="hoheiY" min="0" max="512" value="300"><span id="hoheiYVal">300</span>
</div>

<div class="controls-row">
<label>サイズ:</label> <input type="range" id="hoheiSize" min="20" max="80" value="40"><span id="hoheiSizeVal">40</span>
</div>
</div>

<div id="jinja" class="tab-content">
<div class="controls-row">
<label>表示:</label> <input type="checkbox" id="jinjaEnabled" checked>
<label>神社名:</label> <input type="text" id="jinjaText" value="神宮寺" size="20">
<label>色:</label> <select id="jinjaColor">
<option value="#000000">黒</option>
<option value="#d40000">赤</option>
</select>
</div>
<div class="controls-row">
<label>フォント:</label>
<select id="jinjaFont">
<option value="Klee One" selected>Klee One</option>
<option value="Kosugi Maru">Kosugi Maru</option>
<option value="Potta One">Potta One</option>
<option value="Yuji Boku">Yuji Boku</option>
<option value="Yuji Syuku">Yuji Syuku</option>
<option value="Zen Old Mincho">Zen Old Mincho</option>
<option value="'MS Gothic',sans-serif">MS Gothic</option>
<option value="'MS Mincho',serif">MS Mincho</option>
</select>
</div>
<div class="controls-row">
<label>X位置:</label> <input type="range" id="jinjaX" min="0" max="512" value="256"><span id="jinjaXVal">256</span>
<label>Y位置:</label> <input type="range" id="jinjaY" min="0" max="512" value="100"><span id="jinjaYVal">100</span>
</div>
<div class="controls-row">
<label>サイズ:</label> <input type="range" id="jinjaSize" min="20" max="80" value="50"><span id="jinjaSizeVal">50</span>
</div>
</div>

<div id="stamp" class="tab-content">
<div class="controls-row">
<label>表示:</label> <input type="checkbox" id="stampEnabled" checked>
<label>アップロード:</label> <input type="file" id="stampUpload" accept="image/*">
</div>
<div class="controls-row">
<label>X位置:</label> <input type="range" id="stampX" min="0" max="512" value="256"><span id="stampXVal">256</span>
<label>Y位置:</label> <input type="range" id="stampY" min="0" max="512" value="256"><span id="stampYVal">256</span>
</div>
<div class="controls-row">
<label>サイズ:</label> <input type="range" id="stampSize" min="50" max="300" value="150"><span id="stampSizeVal">150</span>
</div>
</div>

<div id="save" class="tab-content">
<button class="big-btn" id="downloadBtn">単体保存</button>
<button class="big-btn" id="saveSettingsBtn">設定保存</button>
<input type="file" id="loadSettingsInput" accept=".json" style="display:none;">
<button class="big-btn" id="loadSettingsBtn">設定読み込み</button>
</div>

<canvas id="goshuinCanvas" width="512" height="512"></canvas>
<div id="version">Goshuin Custom Pro - Full Version ♡ 2025.12.29 完成！</div>
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

<script>
// --- 変数 ---
const canvas=document.getElementById('goshuinCanvas'), ctx=canvas.getContext('2d');
let currentMonth=1;
let templates=[], selectedTemplate=null, stampImage=null;
let dragLayer=null, dragOffsetX=0, dragOffsetY=0;

// --- タブ ---
document.querySelectorAll('.tab-btn').forEach(btn=>{
  btn.onclick=()=>{document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));btn.classList.add('active');document.getElementById(btn.dataset.tab).classList.add('active');drawAll();}
});

// --- 背景 ---
document.getElementById('templateUpload').onchange=e=>{
  Array.from(e.target.files).forEach(file=>{
    const reader=new FileReader();
    reader.onload=ev=>{
      const id=Date.now();
      templates.push({id,dataURL:ev.target.result});
      renderTemplateList();
      if(!selectedTemplate) selectTemplate(templates[templates.length-1]);
    };
    reader.readAsDataURL(file);
  });
};

function renderTemplateList(){
  const list=document.getElementById('template-list'); list.innerHTML='';
  templates.forEach(t=>{
    const div=d
