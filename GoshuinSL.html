<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>SL用御朱印生成 for Second Life</title>

<!-- キャッシュ強制回避 -->
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<style>
/* （スタイル部分は変更なし、前回と同じ） */
@font-face { font-family: 'KouzanBrush'; src: url('./KouzanBrushFont.woff2') format('woff2'); }
body { margin: 0; padding: 20px; background: url('./Iwakura.webp') no-repeat center center fixed; background-size: cover; font-family: sans-serif; text-align: center; }
/* ... 以下すべて前回と同じスタイル ... */
#version { margin-top: 30px; font-size: 12px; color: #666; font-family: 'MS Gothic', sans-serif; }
</style>
</head>
<body>

<!-- （HTML本体部分は前回と同じ） -->

<canvas id="goshuinCanvas"></canvas>

<div id="version">Ver. 2025.12.28-2405</div>  <!-- バージョン更新！ -->

<!-- JSZip と FileSaver の読み込み（integrity追加で安定化） -->
<script 
  src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.11.0/jszip.min.js" 
  integrity="sha512-7z9Qf1OUUeH0U8nC9E0vO8L6pX8z2f4cfr0f4lQ0pJ1sO9z4v0I/+fWo0soJ8c9PqJ1F0O4uJq8V9Ynl2v7Z9fF9zQ==" 
  crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script 
  src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js" 
  integrity="sha512-9r7Z1qV4nO+jrZ3iXqT7i2c6u0W4gS0zYmQi4FZ3u9cN+4W9w4B3gL3q4fO3fTqV5k1r5V2Oph0xrq3/4r5k7k2Q==" 
  crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>
// ライブラリ読み込み確認（エラー対策）
if (typeof JSZip === 'undefined') {
  alert('JSZipライブラリが読み込めませんでした。ページをハードリロード（Ctrl+Shift+R）してください。');
}
if (typeof saveAs === 'undefined') {
  alert('FileSaverライブラリが読み込めませんでした。ページをハードリロード（Ctrl+Shift+R）してください。');
}

// （ここから前回と同じ全スクリプトコード）
const canvas = document.getElementById("goshuinCanvas");
// ...（すべての変数定義、関数定義は前回と同じ）...

// drawMonth関数（定義順安全確保）
async function drawMonth(month, year) {
  // ...（前回と同じコード）...
}

// 一括ダウンロード（進捗付き）
document.getElementById("downloadAllBtn").onclick = async () => {
  if (typeof JSZip === 'undefined') {
    alert('JSZipが利用できません。ページをリロードしてください。');
    return;
  }
  // ...（前回と同じtry-catch内のコード）...
};

// その他のコードすべて前回と同じ

drawMonth(currentMonth, getSelectedYear());
</script>
</body>
</html>
