<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>御朱印ジェネレーター</title>

<style>
@font-face {
  font-family: 'KouzanBrush';
  src: url('./KouzanBrushFont.woff2') format('woff2');
}

/* ページ全体背景：幅合わせ */
body {
  margin: 0;
  min-height: 100vh;
  background: url('./KamiyashiroGoshuin.webp') no-repeat top center;
  background-size: 100vw auto;   /* ★ ウィンドウ幅合わせ */
  display: flex;
  justify-content: center;
  align-items: center;
  font-family: 'KouzanBrush', serif;
}

/* UIラッパー */
.wrapper {
  background: rgba(255,255,255,0.85);
  padding: 20px 24px;
  border-radius: 8px;
  text-align: center;
}

/* 御朱印生成窓 */
canvas {
  width: 600px;       /* 表示サイズ固定 */
  height: 900px;
  background: #fff;   /* 透け防止 */
  border: 2px solid #333;
  display: block;
  margin: 0 auto;
}

button {
  margin: 12px 8px 0;
  padding: 10px 20px;
  font-size: 16px;
  cursor: pointer;
}
</style>
</head>

<body>
<div class="wrapper">
  <h2>御朱印ジェネレーター</h2>

  <canvas id="goshuinCanvas"></canvas>

  <div>
    <button id="generateBtn">御朱印生成</button>
    <button id="downloadBtn">ダウンロード（WebP）</button>
  </div>
</div>

<script>
const canvas = document.getElementById("goshuinCanvas");
const ctx = canvas.getContext("2d");

/* 描画解像度（巨大化防止） */
canvas.width  = 1200;
canvas.height = 1800;

/* 和暦（令和のみ） */
function getJapaneseDate(d) {
  const k = ["〇","一","二","三","四","五","六","七","八","九"];
  const y = [...String(d.getFullYear() - 2018)].map(n=>k[n]).join("");
  const m = d.getMonth()+1;
  const day = d.getDate();

  const ms = m<=10 ? k[m] : "十"+(m-10?k[m-10]:"");
  const ds =
    day<=10 ? k[day] :
    day<20 ? "十"+(day-10?k[day-10]:"") :
    day<30 ? "二十"+(day-20?k[day-20]:"") :
    "三十";

  return `令和${y}年${ms}月${ds}日`;
}

/* 縦書き */
function drawVertical(text, x, y, size) {
  const lh = size * 1.2;
  for (let i=0; i<text.length; i++) {
    ctx.fillText(text[i], x, y + i * lh);
  }
}

/* 初期表示 */
function preview() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.font = "64px 'KouzanBrush'";
  ctx.fillStyle = "#000";
  ctx.textAlign = "center";
  ctx.fillText("ここ御朱印が表示されます",
    canvas.width/2, canvas.height/2);
}

/* 御朱印生成 */
function generate() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const dateStr = getJapaneseDate(new Date());
  const size = Math.floor(canvas.width / 16 * 1.5);

  ctx.font = size + "px 'KouzanBrush'";
  ctx.fillStyle = "#000";
  ctx.textAlign = "center";

  /* 左下詰め */
  const totalH = size * 1.2 * dateStr.length;
  const x = size * 1.1;
  const y = canvas.height - totalH - size * 0.6;

  drawVertical(dateStr, x, y, size);
}

/* DL */
function download() {
  const a = document.createElement("a");
  a.download = "KamiyashiroGoshuin.webp";
  a.href = canvas.toDataURL("image/webp");
  a.click();
}

preview();
document.getElementById("generateBtn").onclick = generate;
document.getElementById("downloadBtn").onclick = download;
</script>
</body>
</html>
