<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>御朱印ジェネレーター</title>

<style>
  @font-face {
    font-family: 'KouzanBrush';
    src: url('./KouzanBrushFont.woff2') format('woff2');
  }

  /* ★ ページ全体の背景 */
  body {
    margin: 0;
    min-height: 100vh;
    background: url('./Iwakura.webp') no-repeat center center fixed;
    background-size: contain; /* cover にしないのが御朱印向き */
    font-family: 'KouzanBrush', serif;
    text-align: center;
  }

  .wrapper {
    padding-top: 40px;
  }

  canvas {
    background: transparent;   /* ★ 重要 */
    border: 2px solid #333;     /* 不要なら削除OK */
  }

  button {
    margin: 15px 10px;
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
  }
</style>
</head>

<body>
<div class="wrapper">
  <h1>御朱印ジェネレーター</h1>

  <canvas id="goshuinCanvas"></canvas><br>

  <button id="generateBtn">御朱印生成</button>
  <button id="downloadBtn">ダウンロード（WebP）</button>
</div>

<script>
const canvas = document.getElementById("goshuinCanvas");
const ctx = canvas.getContext("2d");

// キャンバスサイズ（背景画像に合わせる想定）
canvas.width  = 1200;
canvas.height = 1600;

// 和暦（令和）
function getJapaneseDate(date) {
  const k = ["〇","一","二","三","四","五","六","七","八","九"];
  const y = [...String(date.getFullYear() - 2018)].map(d=>k[d]).join("");
  const m = date.getMonth()+1;
  const d = date.getDate();

  const ms = m<=10 ? k[m] : "十"+(m-10?k[m-10]:"");
  const ds =
    d<=10 ? k[d] :
    d<20 ? "十"+(d-10?k[d-10]:"") :
    d<30 ? "二十"+(d-20?k[d-20]:"") :
    "三十";

  return `令和${y}年${ms}月${ds}日`;
}

// 縦書き
function drawVertical(text, x, y, size) {
  const lh = size * 1.2;
  for (let i=0; i<text.length; i++) {
    ctx.fillText(text[i], x, y + i*lh);
  }
}

// 初期表示
function preview() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.font = "48px 'KouzanBrush'";
  ctx.fillStyle = "#000";
  ctx.textAlign = "center";
  ctx.fillText("ここ御朱印が表示されます", canvas.width/2, canvas.height/2);
}

// 生成
function generate() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const dateStr = getJapaneseDate(new Date());
  const size = Math.floor(canvas.width / 16 * 1.5);

  ctx.font = size + "px 'KouzanBrush'";
  ctx.fillStyle = "#000";
  ctx.textAlign = "center";

  // 左下詰め
  const totalH = size * 1.2 * dateStr.length;
  const x = size * 1.1;
  const y = canvas.height - totalH - size * 0.6;

  drawVertical(dateStr, x, y, size);
}

// DL
function download() {
  const a = document.createElement("a");
  a.download = "KamiyashiroGoshuin.webp";
  a.href = canvas.toDataURL("image/webp");
  a.click();
}

preview();
generateBtn.onclick = generate;
downloadBtn.onclick = download;
</script>
</body>
</html>
